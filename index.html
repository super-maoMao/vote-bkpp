<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <title>vote</title>
    <link rel="stylesheet" href="css/vote.css">
    <link rel="stylesheet" href="css/vote-rewrite-other.css">
    <style></style>
  </head>
  <body>
    <div class="vote-box">
      <div class="vote-top">
        <div class="vote">
          <div class="vote-open" onclick="openVote()">ÂºÄÂêØÊäïÁ•® ü•• üíô üå∫</div>
          <div class="vote-close" onclick="closeVote()">ÂÖ≥Èó≠ÊäïÁ•® üå∫ üíô ü••</div>
        </div>
        <div class="vote-sum">
          ÂΩìÂâç ÊàêÂäüÊäïÁ•®Ôºö<span class="vote-sum-successs">0</span>
          Á•®ÔºåÂ§±Ë¥•ÊäïÁ•®Ôºö<span class="vote-sum-over">0</span> Á•®
        </div>
      </div>

      <div class="vote-num"></div>
      <div class="vote-from">¬©2021 BKPP_CHNVotingFactory</div>
    </div>

    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="js/sweetAlert.min.js"></script>
    <script>
      // Â£∞ÊòéÂèòÈáè
      let baseObj = {
        fullname: "changmao",
        phone: "0901281930",
        email: "1048922590@qq.com",
        // province_id:"‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£",
        // province_id:"‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà",
        province_id: "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå",
        // province_id:"‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£",
        // province_id:"‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô",
        // province_id:"‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤",
        // province_id:"‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó",
        // province_id:"‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥",
        // province_id:"‡∏ä‡∏∏‡∏°‡∏û‡∏£",
        // province_id:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢",
        // province_id:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
        // province_id:"‡∏ï‡∏£‡∏±‡∏á",
        // province_id:"‡∏ï‡∏£‡∏≤‡∏î",
        // province_id:"‡∏ï‡∏≤‡∏Å",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä",
        // province_id:"‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå",
        // province_id:"‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™",
        // province_id:"‡∏ô‡πà‡∏≤‡∏ô",
        // province_id:"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨",
        // province_id:"‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå",
        // province_id:"‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå",
        // province_id:"‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤",
        // province_id:"‡∏û‡∏±‡∏á‡∏á‡∏≤",
        // province_id:"‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á",
        // province_id:"‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£",
        // province_id:"‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å",
        // province_id:"‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå",
        // province_id:"‡πÅ‡∏û‡∏£‡πà",
        // province_id:"‡∏û‡∏∞‡πÄ‡∏¢‡∏≤",
        // province_id:"‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï",
        // province_id:"‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°",
        // province_id:"‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£",
        // province_id:"‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô",
        // province_id:"‡∏¢‡∏∞‡∏•‡∏≤",
        // province_id:"‡∏¢‡πÇ‡∏™‡∏ò‡∏£",
        // province_id:"‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î",
        // province_id:"‡∏£‡∏∞‡∏ô‡∏≠‡∏á",
        // province_id:"‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
        // province_id:"‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏•‡∏≥‡∏õ‡∏≤‡∏á",
        // province_id:"‡∏•‡∏≥‡∏û‡∏π‡∏ô",
        // province_id:"‡πÄ‡∏•‡∏¢",
        // province_id:"‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©",
        // province_id:"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£",
        // province_id:"‡∏™‡∏á‡∏Ç‡∏•‡∏≤",
        // province_id:"‡∏™‡∏ï‡∏π‡∏•",
        // province_id:"‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",
        // province_id:"‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°",
        // province_id:"‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£",
        // province_id:"‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡∏ß‡πâ",
        // province_id:"‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢",
        // province_id:"‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ",
        // province_id:"‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå",
        // province_id:"‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢",
        // province_id:"‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π",
        // province_id:"‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á",
        // province_id:"‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå",
        // province_id:"‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ",
        // province_id:"‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç",
        vote: [
          {
            award_id: 14,
            contender_id: 64,
          },
          {
            award_id: 18,
            contender_id: 86,
          },
        ],
      };
      let arr = [
        {
          ip: "114.247.184.190",
        },
        {
          ip: "114.247.184.191",
        },
        {
          ip: "114.247.184.192",
        },
        {
          ip: "114.247.184.193",
        },
        {
          ip: "114.247.184.194",
        },
        {
          ip: "114.247.184.195",
        },
        {
          ip: "114.247.184.196",
        },
        {
          ip: "114.247.184.197",
        },
        {
          ip: "114.247.184.198",
        },
        {
          ip: "114.247.184.199",
        },
        {
          ip: "111.196.189.20",
        },
        {
          ip: "111.196.189.21",
        },
        {
          ip: "111.196.189.22",
        },
        {
          ip: "111.196.189.23",
        },
        {
          ip: "111.196.189.24",
        },
        {
          ip: "111.196.189.25",
        },
        {
          ip: "111.196.189.26",
        },
        {
          ip: "111.196.189.27",
        },
        {
          ip: "111.196.189.28",
        },
        {
          ip: "111.196.189.29",
        },
        {
          ip: "185.213.148.180",
        },
        {
          ip: "185.213.148.181",
        },
        {
          ip: "185.213.148.182",
        },
        {
          ip: "185.213.148.183",
        },
        {
          ip: "185.213.148.184",
        },
        {
          ip: "185.213.148.185",
        },
        {
          ip: "185.213.148.186",
        },
        {
          ip: "185.213.148.187",
        },
        {
          ip: "185.213.148.188",
        },
        {
          ip: "185.213.148.189",
        },
        {
          ip: "185.213.148.170",
        },
        {
          ip: "185.213.148.171",
        },
        {
          ip: "185.213.148.172",
        },
        {
          ip: "185.213.148.173",
        },
        {
          ip: "185.213.148.174",
        },
        {
          ip: "185.213.148.175",
        },
        {
          ip: "185.213.148.176",
        },
        {
          ip: "185.213.148.177",
        },
        {
          ip: "185.213.148.178",
        },
        {
          ip: "185.213.148.179",
        },
        {
          ip: "185.213.148.160",
        },
        {
          ip: "185.213.148.161",
        },
        {
          ip: "185.213.148.162",
        },
        {
          ip: "185.213.148.163",
        },
        {
          ip: "185.213.148.164",
        },
        {
          ip: "185.213.148.165",
        },
        {
          ip: "185.213.148.166",
        },
        {
          ip: "185.213.148.167",
        },
        {
          ip: "185.213.148.168",
        },
        {
          ip: "185.213.148.169",
        },
      ];
      let timer = null;
      let timerArr = [];
      let allSuccessNum = 0; //ÂΩìÂâçÊàêÂäüÁ•®Êï∞
      let alloverNum = 0; //ÂΩìÂâçÊàêÂäüÁ•®Êï∞
      // Âæ™ÁéØip,ÂèëÈÄÅËØ∑Ê±Ç
      function forVote() {
        let timeDate = formatDate();

        for (let i = 0; i < arr.length; i++) {
          let item = arr[i];
          let baseItem = { ...baseObj, ...item };
          votePost(baseItem);
        }
        timerArr.push({ time: timeDate });

        $(".vote-num").html("");
        for (let j = 0; j < timerArr.length; j++) {
          let item = timerArr[j];
          $(".vote-num").append(`<div>ÂΩìÂâçÊó∂Èó¥Ôºö${item.time} ÂºÄÂßãÊäïÁ•®</div>`);
        }
      }

      // fetch ÂèëÈÄÅËØ∑Ê±Ç „Äêjson„Äë
      function votePost(item) {
        fetch("https://api.komchadluek.net/api/award/vote", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            token:
              "VUkTC4BtyUGVt6u2UnF76BcKjXB9pu2zKEazSVudMzSDQfZsDkQS3wAjxwa7mg2MZWfRyers7N9ygv8Hb7hyPUXqpsZyqqpURkRJzzB67LYBGDB8PhVWBDS6v5mBVnVW",
          },
          body: JSON.stringify({
            ...item,
          }),
        })
          .then((res) => {
            console.log(res);
            return res.json();
          })
          .then((json) => {
            console.log("Ëé∑ÂèñÁöÑÁªìÊûú", json);
            if (json == "success") {
              // console.log("ËøõÊù•Âï¶");
              allSuccessNum++;
              $(".vote-sum-successs").html(allSuccessNum);
            } else {
              // console.log("ËøõÊù•Âï¶+++");
              alloverNum++;
              $(".vote-sum-over").html(alloverNum);
            }
            return json;
          })
          .catch((err) => {
            console.log("ËØ∑Ê±ÇÈîôËØØ", err);
          });
      }

      // ÂºÄÂêØËΩÆËØ¢
      function openVote() {
        swal({
          title: "ÂºÄÂêØÊäïÁ•®Âï¶!",
          // text: "ÂìáÂì¶!",
          icon: "success",
        });
        if (timer) {
          swal({
            title: "Â∑≤ÁªèÂºÄÂêØÊäïÁ•®Âï¶Ôºå‰∏çË¶ÅÈáçÂ§çÂºÄÂêØÂë¶!",
            // text: "ÂìáÂì¶!",
            icon: "success",
          });
          return;
        }

        $(".vote-sum").css({ display: "block" });

        // ËøõÂÖ•È°µÈù¢ËØ∑Ê±Ç‰∏ÄÊ¨°
        forVote();

        // ÂºÄÂêØÊó∂Èó¥ËΩÆËØ¢Ôºå‰∏∫ÂÆπÈîôÂ∞ΩÈáè11ÂàÜÈíü‰∏ÄÊ¨°
        timer = setInterval(() => {
          forVote();
        }, 1000 * 60 * 11);
      }

      //ÂÖ≥Èó≠ËΩÆËØ¢
      function closeVote() {
        swal({
          title: "ÊäïÁ•®ÂÖ≥Èó≠Âï¶!",
          // text: "ÂìáÂì¶!",
          icon: "success",
        });
        if (timer) {
          clearInterval(timer);
          timer = null;
          timerArr = [];
          $(".vote-num").html("");
        }
      }

      //Êç¢ÁÆóÂΩìÂâçÊó∂Èó¥
      function formatDate() {
        var dateTime = new Date().getTime();
        var date = new Date(dateTime);
        let monthT = date.getMonth() + 1;
        return `${date.getFullYear()}-${monthT < 10 ? "0" + monthT : monthT}-${
          date.getDate() < 10 ? "0" + date.getDate() : date.getDate()
        } ${date.getHours() < 10 ? "0" + date.getHours() : date.getHours()}:${
          date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes()
        }:${
          date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds()
        }`;
      }
    </script>
  </body>
</html>
